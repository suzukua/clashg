inbound-tfo: true
listeners:
  - {"name": "go-home","type": "shadowsocks","port": 29999,"listen": "0.0.0.0","cipher": "aes-128-gcm","password": "password","udp": true}
allow-lan: true
tproxy: true
tproxy-port: 23458
# off, 不匹配进程，推荐在路由器上使用此模式
find-process-mode: off
mode: rule
#自定义 geodata url
geox-url:
  mmdb: "https://mirror.ghproxy.com/https://raw.githubusercontent.com/Loyalsoldier/geoip/release/Country-only-cn-private.mmdb"
geo-auto-update: true # 是否自动更新 geodata
geo-update-interval: 24 # 更新间隔，单位：小时
log-level: error
external-controller: 192.168.100.1:9093
external-controller-tls: 192.168.100.1:9443
secret: clash

#缓存设置(文件位置./cache.db)
profile:
  #节点状态记忆
  store-selected: true
  #fake-ip缓存
  store-fake-ip: true

#【Meta专属】TCP连接并发，如果域名解析结果对应多个IP, 并发所有IP，选择握手最快的IP进行连接
#tcp-concurrent: true

dns:
  enable: true
  #  perfer-h3: true # 开启 DoH 支持 HTTP/3，将并发尝试
  ipv6: true
  listen: :23453
  #DNS模式(redir-host/fake-ip),【Meta专属】redir-host传递域名，可远程解析
  enhanced-mode: fake-ip
  #Fake-IP解析地址池
  fake-ip-range: 198.18.0.1/16
  #查询hosts配置并返回真实IP
  use-hosts: true
  default-nameserver:
    - 223.5.5.5
    - 119.29.29.29
  nameserver:
    - 223.5.5.5
    - 119.29.29.29
sniffer:
  enable: true
  sniff:
    HTTP:
      ports: [ 80, 8080-8880 ]
      override-destination: true
    TLS:
      ports: [ 443, 8443 ]
    QUIC:
      ports: [ 443, 8443 ]
  skip-domain:
    - 'Mijia Cloud'

# 订阅代理
proxy-providers:
  warp-proxies:
    type: http
    path: ./gfw-proxies.yaml
    url: "http://192.168.100.2:3001/get-my-subscribe/download/warp?target=ClashMeta"
    interval: 600
  zhs-proxies:
    type: http
    path: ./openai-proxies.yaml
    url: "http://192.168.100.2:3001/get-my-subscribe/download/zhs?target=ClashMeta"
    interval: 43200

proxy-groups:
  - name: "\U0001F680 节点选择"
    type: select
    proxies:
      - "♻️ 自动选择"
      - DIRECT
    include-all-providers: true
    exclude-filter: "(?i)ai"
  - name: "\U0001F4AC OpenAi"
    type: select
    proxies:
      - "♻️ 自动选择AI"
      - DIRECT
    url: https://chat.openai.com
    expected-status: 200
    interval: 300
    include-all-providers: true
    filter: "(?i)ai"
  - name: "♻️ 自动选择"
    type: url-test
    url: https://cp.cloudflare.com/generate_204
    interval: 300
    include-all-providers: true
    exclude-filter: "(?i)ai"
  - name: "♻️ 自动选择AI"
    type: url-test
    url: https://chat.openai.com
    expected-status: 200
    interval: 300
    include-all-providers: true
    filter: "(?i)ai"

rule-providers:
  openai:
    type: http
    behavior: classical
    format: yaml
    path: ./openai-rules.yaml
    url: "https://gitlab.com/lodepuly/proxy_tool_resources/-/raw/master/rule/Clash/OpenAI/OpenAI_No_Resolve.yaml?ref_type=heads"
    interval: 86400

rules:
  - "GEOIP,PRIVATE,DIRECT,no-resolve"
  - "RULE-SET,openai,\U0001F4AC OpenAi"
  - "MATCH,\U0001F680 节点选择"
